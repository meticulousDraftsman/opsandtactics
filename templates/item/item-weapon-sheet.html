<form class="{{cssClass}}" autocomplete="off">
    <header class="sheet-header">
        <img class="item-img" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
        <div class="header-fields">
          <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Name"/></h1>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="stats">Statistics</a>
        <a class="item" data-tab="attacks">Attacks</a>
        <a class="item" data-tab="description">Description</a>
      </nav>

    <section class="sheet-body">
        <div class="tab" data-group="primary" data-tab="stats">
            <fieldset>
                <legend class="resource-label">
                    Weapon Statistics {{#if item.actor}}<a class="item-control self-destruct" data-tooltip="Delete Item"><i class="fas fa-trash"></i></a>{{/if}}
                </legend>
                <div class="grid grid-12col flex-group-center">
                    <span class="grid-span-3">Weapon Range</span>
                    <input name="system.range" value="{{system.range}}" type="text" data-dtype="String" placeholder="ft">
                    <span class="grid-span-3">Critical Range</span>
                    <input name="system.crit" value="{{system.crit}}" type="text" data-dtype="Number" placeholder="-">
                    <span class="grid-span-3">Error Range %</span>
                    <input name="system.error" value="{{system.error}}" type="text" data-dtype="Number" placeholder="%">
                    <select class="grid-span-3 flex-group-center" name="system.magazine.type" data-dtype="String">
                    {{#select system.magazine.type}}
                        <option value="internal">Internal</option>
                        <option value="external">External</option>
                        <option value="coolant">Fusion</option>
                        <option value="unlimited">Ammo n/A</option>
                    {{/select}}
                    </select>
                    {{#unless (eq system.magazine.type "unlimited")}}
                        {{#if (eq system.magazine.type "internal")}}
                            <span class="grid-span-2">Loaded</span>
                            <input name="system.magazine.value" value="{{system.magazine.value}}" type="text" data-dtype="Number" placeholder="0"/>
                            <span class="grid-span-2">Capacity</span>
                            <input name="system.magazine.max" value="{{system.magazine.max}}" type="text" data-dtype="Number" placeholder="0"/>
                            <a class="mag-load resource-label grid-span-3" data-tooltip="Transfer ammo between internal magazine and other resources">Load/Unload <i class="fas fa-exchange-alt"></i></a>
                        {{else}}
                            {{#if (eq system.magazine.type "coolant")}}
                                <select class="grid-span-5 flex-group-center" name="system.magazine.source" data-dtype="String">
                                    {{selectOptions magazines selected=system.magazine.source nameAttr="id" labelAttr="label"}}                              
                                </select>
                                <span class="grid-span-3">Heat Capacity</span>
                                <input name="system.magazine.max" value="{{system.magazine.max}}" type="text" data-dtype="Number" placeholder="0"/>
                            {{/if}}
                            {{#if (eq system.magazine.type "external")}}
                                <select class="grid-span-6 flex-group-center" name="system.magazine.source" data-dtype="String">
                                    {{selectOptions magazines selected=system.magazine.source nameAttr="id" labelAttr="label"}}
                                </select>
                                <a class="resource-label chamber-round grid-span-2" data-loaded="{{system.magazine.source}}" data-tooltip="Chamber a round from the loaded magazine">Chamber</a>
                                <input name="system.magazine.value" value="{{system.magazine.value}}" type="text" data-dtype="Number" placeholder="+0"/>
                            {{/if}}
                        {{/if}}
                    {{/unless}}

                </div>
            </fieldset>
            <fieldset>
                <legend class="resource-label">
                    Weapon Modifiers 
                </legend>
                <div class="grid grid-10col flex-group-center">
                    <select class="filter-select grid-span-4" name="system.importFilter" data-dtype="String">
                        {{selectOptions importableMods selected=system.importFilter nameAttr="name" labelAttr="name" blank="Create New"}}
                    </select>
                    {{#if (eq system.importFilter "")}}
                    <span class="grid-span-6"></span>
                    {{else}}
                    <select class="grid-span-6" name="system.importMod" data-dtype="String" >
                        {{#with (lookup importableMods @root.system.importFilter)}}
                        {{selectOptions this.entries selected=@root.system.importMod nameAttr="value" labelAttr="label" blank=""}}
                        {{/with}}
                    </select>
                    {{/if}}
                    <ol class="items-list flex-group-center grid-span-10">
                        <li class="item items-header resource-label grid grid-8col">
                            <span>To-Hit</span>
                            <span class="grid-span-3">Flat Damage</span>
                            <span class="grid-span-1">Extra Dice</span>
                            <span>Recoil</span>
                            <span>CP</span>
                            <a class="item-control sub-create" data-target-name="weaponMods" data-tooltip="Add Weapon Modifier"><i class="fas fa-plus"></i></a>
                        </li>
                        <li></li>
                        {{#unless (eq system.importFilter "")}}
                        <li class="item grid grid-8col">
                            <input type="text" value="{{item.readyMod.check}}" readonly>
                            <input class="grid-span-3" type="text" value="{{item.readyMod.effect}}" readonly>
                            <input type="text" value="" readonly>
                            <input type="text" value="{{item.readyMod.recoil}}" readonly>
                            <input type="text" value="{{item.readyMod.cp}}" readonly>
                            <i class="grid-span-8">{{item.readyMod.description}}</i>
                        </li>
                        {{/unless}}
                    </ol>
                </div>
                {{#each system.weaponMods}}

                {{/each}}
                <hr>
                <ol class="items-list flex-group-center">
                    {{#each system.weaponMods}}
                    <li class="grid grid-8col flex-group-center">
                        <input class="grid-span-3" name="system.weaponMods.{{@key}}.name" type="text" value="{{this.name}}" data-dtype="String" placeholder="Source"/>
                        <input class="grid-span-5 flex-group-left" name="system.weaponMods.{{@key}}.description" type="text" value="{{this.description}}" data-dtype="String" placeholder="Description"/>
                        <input name="system.weaponMods.{{@key}}.check" type="text" value="{{this.check}}" data-dtype="String" placeholder="0" data-tooltip="To-Hit"/>
                        <input class="grid-span-3" name="system.weaponMods.{{@key}}.effect" type="text" value="{{this.effect}}" data-dtype="String" placeholder="0d0 + 0" data-tooltip="Flat Damage"/>
                        <input name="" type="text" value="" data-dtype="Number" placeholder="0" data-tooltip="Extra Dice" readonly/>
                        <input name="system.weaponMods.{{@key}}.recoil" type="text" value="{{this.recoil}}" data-dtype="Number" placeholder="0" data-tooltip="Recoil"/>
                        <input name="system.weaponMods.{{@key}}.cp" type="text" value="{{this.cp}}" data-dtype="Number" placeholder="0" data-tooltip="Combat Points"/>
                        <a class="item-control sub-delete" data-target-name="weaponMods" data-remove-target="{{@key}}" data-tooltip="Remove Modifier"><i class="fas fa-trash"></i></a>
                        
                    </li>
                    {{#if @last}}
                    {{else}}
                    <hr>
                    {{/if}}
                    {{/each}}
                </ol>
            </fieldset>
        </div>

        <div class="tab" data-group="primary" data-tab="description">
            {{> "systems/opsandtactics/templates/item/parts/item-object.html"}}
        </div>

        <div class="tab" data-group="primary" data-tab="attacks">
            <fieldset>
                <legend class="resource-label">
                    Attacks <a class="item-control sub-create" data-target-name="attacks" data-tooltip="Add Attack"><i class="fas fa-plus"></i></a>
                </legend>
                {{#each system.actions}}
                <fieldset class="attack">
                    <legend>
                        <div class="grid grid-10col flex-group-center">
                          <input class="grid-span-9" name="system.actions.{{@key}}.name" type="text" value="{{this.name}}" data-dtype="String">
                          <a class="item-control sub-delete" data-target-name="actions" data-remove-target="{{@key}}" data-tooltip="Remove Attack"> <i class="fas fa-trash"></i></a>
                        </div>
                    </legend>
                    <ol class="items-list">
                        <li class="item grid grid-9col flex-group-center">
                            <span>Active</span>
                            <div>
                                <input name="system.actions.{{@key}}.active" type="checkbox" {{checked this.active}}/>
                            </div>
                            <select class="grid-span-3 flex-group-center" name="system.actions.{{@key}}.check.type">
                                {{#select this.check.type}}
                                    <option value="melee">Melee Attack</option>
                                    <option value="ranged">Ranged Attack</option>
                                    <option value="noneAttack">Message</option>
                                    <option value="noChatAttack">Resources Only</option>
                                {{/select}}
                            </select>
                            <a class="resource-label toggle-value grid-span-2" data-target="system.actions.{{@key}}.display">Details <i class="{{#if this.display}}fas fa-eye-slash{{else}}fas fa-eye{{/if}}"></i></a>
                            <span>{{#if (eq @root.system.magazine.type "coolant")}}Heat{{else}}Ammo{{/if}}</span>
                            <input name="system.actions.{{@key}}.ammo" value = "{{this.ammo}}" type="text" data-dtype="Number">
                        </li>
                        {{#if this.display}}
                        <li class="item grid grid-9col flex-group-center">
                            {{#if (or (eq this.check.type "noneAttack") (eq this.check.type "noChatAttack"))}}
                            <button type="button" class="item-control attack-edit grid-span-3" data-target-name="check" data-pre-target="{{@key}}">To-Hit: N/a</button>
                            <button type="button" class="item-control attack-edit grid-span-3" data-target-name="recoil" data-pre-target="{{@key}}">Recoil: N/a</button>
                            <button type="button" class="item-control attack-edit grid-span-3" data-target-name="cp" data-pre-target="{{@key}}" data-tooltip="Edit Attack Combat Points">CP: {{this.mods.cp}}</button>
                            <input class="grid-span-9 flex-group-center" name="system.actions.{{@key}}.check.flavor" value="{{this.check.flavor}}" type="text" data-dtype="String" placeholder="Attack {{#if (eq this.check.type 'noneAttack')}}Message{{else}}Description{{/if}}">
                            {{else}}
                            <button type="button" class="item-control attack-edit grid-span-3" data-target-name="check" data-pre-target="{{@key}}" data-tooltip="Edit Attack To-Hit">To-Hit: {{this.mods.checkTotal}}</button>
                            <button type="button" class="item-control attack-edit grid-span-3" data-target-name="recoil" data-pre-target="{{@key}}" data-tooltip="Edit Attack Recoil">Recoil: {{#if this.mods.recoil}}{{this.mods.recoil}}{{#if (gt this.mods.reduction 0)}} vs +{{this.mods.reduction}}{{/if}}{{else}}{{#if this.recoil.active}}None{{else}}N/a{{/if}}{{/if}}</button>
                            <button type="button" class="item-control attack-edit grid-span-3" data-target-name="cp" data-pre-target="{{@key}}" data-tooltip="Edit Attack Combat Points">CP: {{this.mods.cp}}</button>
                            <input class="grid-span-9 flex-group-center" name="system.actions.{{@key}}.check.flavor" value="{{this.check.flavor}}" type="text" data-dtype="String" placeholder="Attack roll flavor">
                            {{/if}} 
                        </li>
                        
                        <li class="item grid grid-9col flex-group-center">
                            {{#if (eq this.check.type 'noChatAttack')}}
                            <button type="button" class="item-control attack-edit grid-span-9" data-target-name="effect" data-pre-target="{{@key}}" style="word-wrap: break-word;">Damage: n/A</button>
                            {{else}}
                            <button type="button" class="item-control attack-edit grid-span-9" data-target-name="effect" data-pre-target="{{@key}}" data-tooltip="Edit Attack Damage" style="word-wrap: break-word;">Damage: {{this.mods.effectTotal}}</button>
                            {{/if}}
                            <input class="grid-span-9 flex-group-center" name="system.actions.{{@key}}.effect.flavor" value="{{this.effect.flavor}}" type="text" data-dtype="String" placeholder="Damage {{#if (eq this.check.type 'noChatAttack')}}Description{{else}}roll flavor{{/if}}">
                        </li>
                        {{/if}}
                    </ol>
                </fieldset>
                {{/each}}
            </fieldset>
        </div>
    </section>
</form>