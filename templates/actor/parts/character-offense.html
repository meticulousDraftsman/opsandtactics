<fieldset class=collapse-parent>
    <legend class="resource-label">
        Weapons <a class="item-control item-create" data-tooltip="Create Weapon" data-type="weapon"><i class="fas fa-plus"></i></a> <a data-tooltip="Toggle Weapons List Display"><i class="fas fa-list collapse-toggle" data-collapse="weapons"></i></a>
    </legend>
    <ol class="items-list weapons {{#if collapses.weapons}}collapse{{/if}}">
        {{#each weapons as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend item-context" data-item-id="{{item._id}}">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-5col action-pane {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-2">
                        <div class="grid grid-5col flex-group-center">
                            <span>Crit</span>
                            <input type="text" value="{{item.system.crit}}-18" readonly>
                            {{#if (eq this.system.magazine.type "coolant")}}
                            <span>Heat</span>
                            {{else}}
                            <span>Ammo</span>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "internal")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input class="flex3 item-input" type="text" data-target-prop="system.magazine.value" data-target-id="{{item._id}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input class="flex3" type="text" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "external")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.loaded.value}}" data-dtype="Number"/>
                                <span>{{#if (gt item.system.magazine.value 0)}}+{{item.system.magazine.value}}{{/if}}/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.loaded.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "coolant")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.loaded.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{/if}}
                            <a class="resource-label rollable" data-roll="1d100" data-label="{{this.name}} {{item.system.error}}% Error Range" data-tooltip="Roll for Jam Potential">Error</a>
                            <input type="text" value="{{item.system.error}}%" data-dtype="Number" readonly>
                            <span>Range</span>
                            <input class="grid-span-2 item-input" type="text" data-target-prop="system.range" data-target-id="{{item._id}}" value="{{item.system.range}}" data-dtype="Number">
                        </div>
                    </div>
                    <ol class="grid-span-3 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        <li class="item flexrow">
                            <a class="item-check resource-label flex-group-left {{#unless this.mods.effectTotal}}flex2{{/unless}}" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="{{#if (or (eq this.check.type 'melee') (eq this.check.type 'ranged'))}}Attack Roll{{/if}}{{#if (eq this.check.type 'noneAttack')}}Attack Message{{/if}}{{#if (eq this.check.type 'noChatAttack')}}Attack Resources{{/if}}">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label {{#unless this.mods.effectTotal}}collapse{{/unless}}" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Damage Roll">{{this.mods.effectTotal}}</a>
                            <span class="grid-start-3">{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>
        </li>
        {{/each}}
    </ol>
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Objects <a data-tooltip="Toggle Object Attack List Display"><i class="fas fa-list collapse-toggle" data-collapse="objectAttacks"></i></a>
    </legend>
    <ol class="items-list objectAttacks {{#if collapses.objectAttacks}}collapse{{/if}}">
        {{#each attackObjects as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend item-context" data-item-id="{{item._id}}">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-5col action-pane {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-2">
                        <div class="grid grid-5col flex-group-center">
                            <span>Crit</span>
                            <input type="text" value="{{item.system.crit}}-18" readonly>
                            <span>Uses</span>
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{else}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    <ol class="grid-span-3 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        {{#if (eq this.type "attack")}}
                        <li class="item flexrow">
                            <a class="item-check resource-label flex-group-left {{#unless this.mods.effectTotal}}flex2{{/unless}}" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="{{#if (or (eq this.check.type 'melee') (eq this.check.type 'ranged'))}}Attack Roll{{/if}}{{#if (eq this.check.type 'noneAttack')}}Attack Message{{/if}}{{#if (eq this.check.type 'noChatAttack')}}Attack Resources{{/if}}">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label {{#unless this.mods.effectTotal}}collapse{{/unless}}" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Damage Roll">{{this.mods.effectTotal}}</a>
                            <span>{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>            
        </li>
        {{/each}}
    </ol>
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Magic <a data-tooltip="Toggle Magic List Display"><i class="fas fa-list collapse-toggle" data-collapse="magicAttacks"></i></a>
    </legend>
    <ol class="items-list magicAttacks {{#if collapses.magicAttacks}}collapse{{/if}}">
        {{#each attackMagic as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend item-context" data-item-id="{{item._id}}">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-5col action-pane {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-2">
                        <div class="grid grid-5col flex-group-center">
                            {{#unless (eq item.system.magazine.type "mental")}}
                            <span class="grid-start-2 grid-span-2">Charges</span>
                            {{else}}
                            <span class="grid-start-2 grid-span-2">Mental Limit</span>
                            {{/unless}}
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "external")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                            {{#if (eq system.magazine.type "mental")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="flex3" value="{{@root.system.magic.mlUsed}}" data-dtype="Number" readonly/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{@root.system.ml.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    <ol class="grid-span-3 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        {{#if (eq this.type "attack")}}
                        <li class="item flexrow">
                            <a class="item-check resource-label flex-group-left {{#unless this.mods.effectTotal}}flex2{{/unless}}" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="{{#if (or (eq this.check.type 'melee') (eq this.check.type 'ranged'))}}Attack Roll{{/if}}{{#if (eq this.check.type 'noneAttack')}}Attack Message{{/if}}{{#if (eq this.check.type 'noChatAttack')}}Attack Resources{{/if}}">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label {{#unless this.mods.effectTotal}}collapse{{/unless}}" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Damage Roll">{{this.mods.effectTotal}}</a>
                            <span>{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>            
        </li>
        {{/each}}
    </ol>    
</fieldset>