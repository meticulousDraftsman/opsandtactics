<fieldset class="collapse-parent">
    <legend class="resource-label">
        Mental Limit <a data-tooltip="Toggle Mental Limit Display"><i class="fas fa-list collapse-toggle" data-collapse="mental"></i></a>
    </legend>
    <div class="mental {{#if collapses.mental}}collapse{{/if}}">
        <div class="grid grid-8col flex-group-center">
            <span class="grid-span-2">Total Mental Limit Used</span>
            <input class="grid-start-4" type="text" value="{{system.magic.mlUsed}}" readonly>   
            <span class="grid-span-3">Total Mental Limit Capacity</span>
            <input type="text" value="{{system.ml.max}}" readonly>       
            <span class="grid-span-2">Misc Mental Limit Costs</span>
            <input type="text" name="system.magic.mods.misc" value="{{system.magic.mods.misc}}" data-dtype="Number" placeholder="Misc">    
            <input type="text" value="{{system.magic.mlMisc}}" readonly>                
            <span class="grid-span-3">Temporary Mental Limit Capacity</span>
            <input type="text" name="system.ml.temp" value="{{system.ml.temp}}" data-dtype="Number" placeholder="0">                              
            <span class="grid-span-2">Psionically Focused</span>
            <div>
                <input name="system.magic.psionFocus" type="checkbox" {{checked system.magic.psionFocus}}/>
            </div>
            <input type="text" value="{{system.magic.mlPsion}}" readonly>
            <span class="grid-span-3">Mental Limit Spent from Objects</span>
            <input type="text" value="{{system.magic.mlObject}}" readonly>    
            <span class="grid-span-2">{{system.magic.numRecipes}} Recipes Memorized</span>
            <div>
                <input name="system.magic.invokerMemorize" type="checkbox" {{checked system.magic.invokerMemorize}}/>
            </div>
            <input type="text" value="{{system.magic.mlRecipe}}" readonly>
            <a class="grid-span-3 resource-label incant-regain" data-tooltip="Regain Mental Limit spent by Invoking">Mental Limit Spent Invoking <i class="fas fa-recycle"></i></a>
            <input type="text" name="system.magic.mlCant" value="{{system.magic.mlCant}}" data-dtype="Number" placeholder="Spent">
        </div>
    </div>
</fieldset>
{{> "systems/opsandtactics/templates/actor/parts/object-resources.html"}}
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Character <a class="action-create"><i class="fas fa-plus"></i></a> <a data-tooltip="Toggle Character Action List Display"><i class="fas fa-list collapse-toggle" data-collapse="characterActions"></i></a>
    </legend>
    <ol class="items-list characterActions {{#if collapses.characterActions}}collapse{{/if}}">
        {{#each system.actions}}
        <li class="item grid grid-12col flex-group-center">
            <input class="grid-span-8" type="text" name="system.actions.{{@key}}.name" value="{{this.name}}" data-dtype="String" placeholder="Character Action">
            <a class="action-spend resource-label" data-check-id="{{@key}}"><i class="fas fa-stopwatch"></i> CP</a>
            <div class="grid-span-2 flexrow flex-group-center">
                <input class="flex3" type="text" name="system.actions.{{@key}}.cost" value="{{this.cost}}" data-dtype="Number" placeholder="0">
                <i class="fas fa-times"></i>
                <input class="flex3" type="text" name="system.actions.{{@key}}.quantity" value="{{this.quantity}}" data-dtype="Number" placeholder="0?">
            </div>
            <div class="flex-group-center">
                <a class="action-delete" data-target="{{@key}}"><i class="fas fa-trash"></i></a>
            </div>
        </li>
        {{/each}}
    </ol>
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Objects <a data-tooltip="Toggle Object Utility List Display"><i class="fas fa-list collapse-toggle" data-collapse="objectUtility"></i></a>
    </legend>
    <ol class="items-list objectUtility {{#if collapses.objectUtility}}collapse{{/if}}">
        {{#each utilityObjects as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-10col action-pane {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-3">
                        <div class="grid grid-3col flex-group-center">
                            <span>Uses</span>
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{else}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    <ol class="grid-span-7 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        {{#if (eq this.type "utility")}}
                        <li class="item flexrow">
                            <a class="item-check resource-label flex-group-left {{#unless this.mods.effectTotal}}flex2{{/unless}}" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="Check Roll">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label {{#unless this.mods.effectTotal}}collapse{{/unless}}" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Effect Roll">{{this.mods.effectTotal}}</a>
                            <span>{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>            
        </li>
        {{/each}}
    </ol>    
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Magic <a class="item-control item-create" data-tooltip="Create Magic" data-type="magic"><i class="fas fa-plus"></i></a> <a data-tooltip="Toggle Magic List Display"><i class="fas fa-list collapse-toggle" data-collapse="magicUtility"></i></a>
    </legend>
    <ol class="items-list magicUtility {{#if collapses.magicUtility}}collapse{{/if}}">
        {{#each utilityMagic as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-10col action-pane {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-3">
                        <div class="grid grid-3col flex-group-center">
                            {{#unless (eq item.system.magazine.type "mental")}}
                            <span>Charges</span>
                            {{else}}
                            <span>Incant</span>
                            {{/unless}}
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "external")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                            {{#if (eq system.magazine.type "mental")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="flex3" value="{{@root.system.magic.mlUsed}}" data-dtype="Number" readonly/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{@root.system.ml.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    <ol class="grid-span-7 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        {{#if (eq this.type "utility")}}
                        <li class="item flexrow">
                            <a class="item-check resource-label flex-group-left {{#unless this.mods.effectTotal}}flex2{{/unless}}" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="Check Roll">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label {{#unless this.mods.effectTotal}}collapse{{/unless}}" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Effect Roll">{{this.mods.effectTotal}}</a>
                            <span>{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>            
        </li>
        {{/each}}
    </ol>    
</fieldset>