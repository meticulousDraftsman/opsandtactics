<form class="{{cssClass}}" autocomplete="off">
  <header class="sheet-header">
    <img class="item-img" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
    <div class="header-fields">
      <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Name"/></h1>
    </div>
</header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="stats">Statistics</a>
    <a class="item" data-tab="description">Description</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    {{!-- Statistics Tab--}}
    <div class="tab" data-group="primary" data-tab="stats">
      <fieldset>
        <legend class="resource-label">
          Magic Properties {{#if item.actor}}<a class="item-control self-destruct" title="Delete Item"><i class="fas fa-trash"></i></a>{{/if}} <a class="item-control sub-create" data-target-name="action" title="Add Action"><i class="fas fa-plus"></i></a>
        </legend>
        <div class="grid grid-3col flex-group-center">
          <select class="flex-group-center" name="system.magazine.type" data-dtype="String">
          {{#select system.magazine.type}}
            <option value="external">External Charges</option>
            <option value="unlimited">Unlimited Use</option>
            <option value="mental">Mental Limit on Use</option>
          {{/select}}
          </select>
          {{#if (eq system.magazine.type "external")}}
          <select class="grid-span-2 flex-group-center" name="system.magazine.source" data-dtype="String">
            {{selectOptions sourceMagics selected=system.magazine.source nameAttr="id" labelAttr="label"}}
          </select>
          {{/if}}
        </div>
      </fieldset>
      {{#each system.actions}}
      <fieldset>
        <legend>
          <div class="flexrow flex-group-center">
            <input name="system.actions.{{@key}}.name" type="text" value="{{this.name}}" data-dtype="String"> <a class="item-control sub-delete flex0" data-target-name="actions" data-remove-target="{{@key}}" title="Remove Action"> <i class="fas fa-trash"></i></a>
          </div>
        </legend>
        <ol class="items-list">
          <li class="item grid grid-9col flex-group-center">
            <span>Active</span>
            <div>
              <input name="system.actions.{{@key}}.active" type=checkbox {{checked this.active}}>
            </div>
            <select class="grid-span-3 flex-group-center" name="system.actions.{{@key}}.check.type">
              {{#select this.check.type}}
                <option value="melee">Melee Attack</option>
                <option value="ranged">Ranged Attack</option>
                <option value="noneAttack">Message (Attack)</option>
                <option value="generic">Generic Check</option>
                <option value="otherUtility">Other Roll</option>
                <option value="noneUtility">Message (Utility)</option>
              {{/select}}
              </select>
              <span>CP</span>
              <input name="system.actions.{{@key}}.cp.inherent" type="text" value="{{this.cp.inherent}}" data-dtype="Number" placeholder="0">
              {{#if (eq ../system.magazine.type "mental")}}
              <span>ML</span>
              {{else}}
              <span>Cost</span>
              {{/if}}
              <input name="system.actions.{{@key}}.ammo" type="text" value="{{this.ammo}}" data-dtype="Number" placeholder="0">   
          </li>
          <li class="item grid grid-9col flex-group-center">
            {{#unless (or (eq this.check.type "noneAttack") (eq this.check.type "noneUtility"))}}
            <span class="grid-span-2">Check Modifier</span>
            <input class="grid-span-4" type="text" name="system.actions.{{@key}}.check.inherent" value="{{this.check.inherent}}" data-dtype="String" placeholder="Inherent">
            <select class="grid-span-3 flex-group-center" name="system.actions.{{@key}}.check.ability" data-dtype="String">
            {{#select this.check.ability}}
              <option value="">Ability Modifier</option>
              {{selectOptions @root.OATS.abilities selected=this.check.ability localize=true}}
            {{/select}}
            </select>          
            {{/unless}}
            <input class="grid-span-9" type="text" name="system.actions.{{@key}}.check.flavor" value="{{this.check.flavor}}" data-dtype="String" placeholder="Check roll flavor">
          </li>
          <li class="item grid grid-9col flex-group-center">
            <span class="grid-span-2">Effect Roll</span>
            <input class="grid-span-4" type="text" name="system.actions.{{@key}}.effect.inherent" value="{{this.effect.inherent}}" data-dtype="String" placeholder="Inherent">
            <select class="grid-span-3 flex-group-center" name="system.actions.{{@key}}.effect.ability" data-dtype="String">
            {{#select this.effect.ability}}
              <option value="">Ability Modifier</option>
              {{selectOptions @root.OATS.abilities selected=this.effect.ability localize=true}}
            {{/select}}
            </select>  
            <input class="grid-span-9" type="text" name="system.actions.{{@key}}.effect.flavor" value="{{this.effect.flavor}}" data-dtype="String" placeholder="Effect roll flavor">
          </li>
        </ol>
      </fieldset>
      {{/each}}
    </div>

    {{!-- Description Tab --}}
    <div class="tab" data-group="primary" data-tab="description">
      <fieldset>
        <legend class="resource-label">
          Description
        </legend>
        <div>
          {{editor enrichDescription target="system.description" rollData=rollData button=true owner=owner editable=editable}}
        </div>
      </fieldset>
    </div>
  </section>
</form>
