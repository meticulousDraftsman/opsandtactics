<fieldset class="collapse-parent">
    <legend class="resource-label">
        Mental Limit <a data-tooltip="Toggle Mental Limit Display"><i class="fas fa-list collapse-toggle" data-collapse="mental"></i></a>
    </legend>
    <div class="mental {{#if collapses.mental}}collapse{{/if}}">
        <div class="grid grid-8col flex-group-center">
            <span class="grid-span-2">Psionically Focused</span>
            <div>
                <input name="system.magic.psionFocus" type="checkbox" {{checked system.magic.psionFocus}}/>
            </div>
            <input type="text" value="{{system.magic.mlPsion}}" readonly>
            <span class="grid-span-3">Mental Limit Capacity</span>
            <input type="text" value="{{system.ml.max}}" readonly>
            <span class="grid-span-2">Recipe Sets Memorized</span>
            <input type="text" name="system.magic.memorizedSets" value="{{system.magic.memorizedSets}}" data-dtype="Number" placeholder="Sets">
            <input type="text" value="{{system.magic.mlRecipe}}" readonly>
            <span class="grid-span-3">Total Mental Limit Used</span>
            <input type="text" value="{{system.magic.mlUsed}}" readonly>
            <span class="grid-span-2">Incantation Use</span>
            <a class="incant-regain"><i class="fas fa-recycle" data-tooltip="Regain Mental Limit spent by Invoking"></i></a>
            <input type="text" name="system.magic.mlCant" value="{{system.magic.mlCant}}" data-dtype="Number" placeholder="Spent">
            <span class="grid-span-3">Temporary Mental Limit</span>
            <input type="text" name="system.ml.temp" value="{{system.ml.temp}}" data-dtype="Number" placeholder="0">
            <span class="grid-span-2">Misc Used Mental Limit</span>
            <input type="text" name="system.magic.mods.misc" value="{{system.magic.mods.misc}}" data-dtype="Number" placeholder="Misc">
            <input type="text" value="{{system.magic.mlMisc}}" readonly>
            <span class="grid-span-3">Object Used Mental Limit</span>
            <input type="text" value="{{system.magic.mlObject}}" readonly>
        </div>
    </div>
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Resources <a data-tooltip="Toggle Resource List Display"><i class="fas fa-list collapse-toggle" data-collapse="resources"></i></a>
    </legend>
    <div class="resources {{#if collapses.resources}}collapse{{/if}}">
        {{#each resObjects}}
        {{#if this.entries.length}}
        <fieldset>
            <legend>
                {{this.label}} 
            </legend>
            <ol class="items-list">  
            {{#each this.entries}}
                <li class="grid grid-10col flex-group-center">
                    <a class="item-control item-edit grid-span-5 flex-group-left" data-item-id="{{this.itemId}}"><i class="fas fa-edit"></i> {{this.name}}</a>
                    {{#if (eq this.type "consumable")}}
                    <div class="grid-span-2 flexrow flex-group-center">
                        <input class="flex3 item-input" type="text" data-target-prop="value" data-target-id="{{this.id}}" value="{{this.value}}" data-dtype="Number" placeholder="Value">
                        <span>/</span>
                        <input class="flex3 item-input" type="text" data-target-prop="max" data-target-id="{{this.id}}" value="{{this.max}}" data-dtype="Number" placeholder="Max">
                    </div>
                    <span class="grid-span-2">Available</span>
                    <div>
                        <input class="flex3 item-checkbox" type="checkbox" data-target-prop="available" data-target-id="{{this.id}}" {{checked this.available}}>
                    </div>
                    {{/if}}
                    {{#if (eq this.type "coolant")}}
                    <input class="grid-span-2 item-input" type="text" data-target-prop="value" data-target-id="{{this.id}}" value="{{this.value}}" data-dtype="Number" placeholder="Value">
                    <span class="grid-span-2">Cool</span>
                    <div>
                        <input class="flex3 item-checkbox" type="checkbox" data-target-prop="available" data-target-id="{{this.id}}" {{checked this.available}}>
                    </div>
                    {{/if}}
                    {{#if (eq this.type "magic")}}
                    <div class="grid-span-2 flexrow flex-group-center">
                        <input class="flex3 item-input" type="text" data-target-prop="value" data-target-id="{{this.id}}" value="{{this.value}}" data-dtype="Number" placeholder="Value">
                        <span>/</span>
                        <input class="flex3 item-input" type="text" data-target-prop="max" data-target-id="{{this.id}}" value="{{this.max}}" data-dtype="Number" placeholder="Max">
                    </div>
                    <span class="grid-span-2">Mental Limit</span>
                    <input class="item-input" type="text" data-target-prop="ml" data-target-id="{{this.id}}" value="{{this.ml}}" data-dtype="Number" placeholder="ML">
                    {{/if}}
                    {{#if (eq this.type "resource")}}
                    <div class="grid-span-5 flexrow flex-group-center">
                        <input class="flex3 item-input" type="text" data-target-prop="value" data-target-id="{{this.id}}" value="{{this.value}}" data-dtype="String" placeholder="Value">
                        <span>/</span>
                        <input class="flex3 item-input" type="text" data-target-prop="max" data-target-id="{{this.id}}" value="{{this.max}}" data-dtype="String" placeholder="Max">
                    </div>
                    {{/if}}
                </li>
            {{/each}}
            </ol>
        </fieldset>
        {{/if}}
        {{/each}}
    </div>
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Objects <a data-tooltip="Toggle Object Utility List Display"><i class="fas fa-list collapse-toggle" data-collapse="objectUtility"></i></a>
    </legend>
    <ol class="items-list objectUtility {{#if collapses.objectUtility}}collapse{{/if}}">
        {{#each utilityObjects as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-10col {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-3">
                        <div class="grid grid-3col flex-group-center">
                            <span>Uses</span>
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{else}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    <ol class="grid-span-7 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        {{#if (eq this.type "utility")}}
                        <li class="item flexrow">
                            <a class="item-check resource-label" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="Check Roll">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Effect Roll">{{this.mods.effectTotal}}</a>
                            <span>{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>            
        </li>
        {{/each}}
    </ol>    
</fieldset>
<fieldset class="collapse-parent">
    <legend class="resource-label">
        Magic <a class="item-control item-create" data-tooltip="Create Magic" data-type="magic"><i class="fas fa-plus"></i></a> <a data-tooltip="Toggle Magic List Display"><i class="fas fa-list collapse-toggle" data-collapse="magicUtility"></i></a>
    </legend>
    <ol class="items-list magicUtility {{#if collapses.magicUtility}}collapse{{/if}}">
        {{#each utilityMagic as |item id|}}
        <li class="item" data-item-id="{{item._id}}">
            <fieldset class="action-item">
                <legend class="action-legend">
                    <a class="item-control item-edit" data-item-id="{{item._id}}" data-tooltip="Edit Item"><i class="fas fa-edit"></i> {{item.name}}</a>
                    <a class="item-control item-toggle" data-target-id="{{this._id}}" data-target-prop="system.minimized" data-tooltip="Minimize Item"><i class="{{#if this.system.minimized}}fas fa-eye{{else}}fas fa-eye-slash{{/if}}"></i></a>
                </legend>
                <div class="grid grid-10col {{#if item.system.minimized}}collapse{{/if}}">
                    <div class="grid-span-3">
                        <div class="grid grid-3col flex-group-center">
                            {{#unless (eq item.system.magazine.type "mental")}}
                            <span>Charges</span>
                            {{else}}
                            <span>Incant</span>
                            {{/unless}}
                            {{#if (eq item.system.magazine.type "unlimited")}}
                            <i class="grid-span-2 fas fa-infinity"></i>
                            {{/if}}
                            {{#if (eq item.system.magazine.type "external")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="item-input flex3" data-target-prop="value" data-target-id="{{item.system.magazine.source}}" value="{{item.system.magazine.value}}" data-dtype="Number"/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{item.system.magazine.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                            {{#if (eq system.magazine.type "mental")}}
                            <div class="grid-span-2 flexrow flex-group-center">
                                <input type="text" class="flex3" value="{{@root.system.magic.mlUsed}}" data-dtype="Number" readonly/>
                                <span>/</span>
                                <input type="text" class="flex3" value="{{@root.system.ml.max}}" data-dtype="Number" readonly/>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    <ol class="grid-span-7 items-list flex-group-center">
                        {{#each item.system.actions}}
                        {{#if this.active}}
                        {{#if (eq this.type "utility")}}
                        <li class="item flexrow">
                            <a class="item-check resource-label" data-item-id="{{../_id}}" data-action-id="{{@key}}" data-tooltip="Check Roll">{{this.mods.checkTotal}} {{this.name}}</a>
                            <a class="rollable grid-span-2 resource-label" data-roll="{{this.mods.effectTotal}}" data-label="{{../name}} - {{this.name}}{{#if this.effect.flavor}} - {{/if}}{{this.effect.flavor}}" data-tooltip="Effect Roll">{{this.mods.effectTotal}}</a>
                            <span>{{this.mods.cpAmmoLabel}}</span>
                        </li>
                        {{/if}}
                        {{/if}}
                        {{/each}}
                    </ol>
                </div>
            </fieldset>            
        </li>
        {{/each}}
    </ol>    
</fieldset>